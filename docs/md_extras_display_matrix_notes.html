<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>muwerk mupplet Display Library: DisplayMatrixMAX72XX Mupplet</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">muwerk mupplet Display Library
   </div>
   <div id="projectbrief">muwerk applets; mupplets: functional units that support specific hardware or reusable applications</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">DisplayMatrixMAX72XX Mupplet </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >The DisplayMatrixMAX72XX mupplet allows to control a led matrix display based on multiple 8x8 led matrix modules driven by a MAX7219 or MAX7221 connected via SPI.</p>
<p >The mupplet acts as an intelligent display server supporting various commands and scenarios.</p>
<h1>Hardware Setup </h1>
<p ><img src="https://github.com/muwerk/mupplet-display/blob/master/extras/Matrix-8x8-MAX7219.jpg" alt="" width="30%" height="30%" class="inline"/></p>
<p >Hardware: WeMos D1 Mini, 3 x MAX7219 8x32 4 in 1 Dot Matrix Display Modules</p>
<h1>General Function Model </h1>
<p >The display server acts like a heavy rotation radio station: there is one <b>program</b> that loops forever. The program is a list of <b>program items</b>. Program items have the following attributes:</p><ul>
<li><code>mode</code> - Item presentation mode mode (See <em>Presentaiton Modes</em>)</li>
<li><code>repeat</code> - How often the program item will be repeated, if <code>0</code>, the item will be repeated until it is manually removed</li>
<li><code>duration</code> - How long the item is displayed before switching to the next item</li>
<li><code>speed</code> - If the item is displayed with an animation effect, the speed of the animation</li>
<li><code>font</code> - The font used to display the item</li>
</ul>
<p >Program items can be added, removed and managed via messages. Additionally the mupplet keeps a set of default program item settings in order to simplify the specification of of program items.</p>
<h2>Presentation Modes</h2>
<p >The follwing presentation modes are supported:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Mode   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Left</code>   </td><td class="markdownTableBodyNone">Left formatted text without any fadin/fadeout animation    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Center</code>   </td><td class="markdownTableBodyNone">Center formatted text without any fadin/fadeout animation    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Right</code>   </td><td class="markdownTableBodyNone">Right formatted text without any fadin/fadeout animation    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>SlideIn</code>   </td><td class="markdownTableBodyNone">Left formatted text with a fadin animation sliding in the characters from right to left   </td></tr>
</table>
<p >More presentation modes are in preparation....</p>
<h1>Messaging Interface </h1>
<p >All messages always start with the <code>&lt;mupplet-name&gt;</code> as first topic part. Therefore all subsequent documentation does not mention this part.</p>
<h2>Display Luminosity</h2>
<p >Since the display has also a luminosity aspect (on, off, blightness) it can be controlled with the standard light messages:</p>
<h3>Light Related Messages sent by Mupplet</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Topic   </th><th class="markdownTableHeadNone">Message Body   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>light/unitbrightness</code>   </td><td class="markdownTableBodyNone">normalized brightness [0.0-1.0]   </td><td class="markdownTableBodyNone"><code>0.34</code>: Float value encoded as string. Not sent on automatic changes (e.g. pulse mode)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>light/state</code>   </td><td class="markdownTableBodyNone"><code>on</code> or <code>off</code>   </td><td class="markdownTableBodyNone">Current light state (<code>on</code> is not sent on pwm intermediate values)   </td></tr>
</table>
<h3>Light Related Messages received by Mupplet</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Topic   </th><th class="markdownTableHeadNone">Message Body   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>light/set</code>   </td><td class="markdownTableBodyNone"><code>on</code>, <code>off</code>, <code>true</code>, <code>false</code>, <code>pct 34</code>, <code>34%</code>, <code>0.34</code>   </td><td class="markdownTableBodyNone">Light can be set fully on or off with on/true and off/false. A fractional brightness of 0.34 (within interval [0.0, 1.0]) can be sent as either <code>pct 34</code>, or <code>0.34</code>, or <code>34%</code>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>light/mode/set</code>   </td><td class="markdownTableBodyNone"><code>passive</code>, <code>pulse &lt;duration_ms&gt;</code>, <code>blink &lt;intervall_ms&gt;[,&lt;phase-shift&gt;]</code>, <code>pattern &lt;pattern&gt;[,&lt;intervall&gt;[,&lt;phase&gt;]]</code> or <code>wave &lt;intervall_ms&gt;[,&lt;phase-shift&gt;]</code>   </td><td class="markdownTableBodyNone">Mode passive does no automatic light state changes, <code>pulse</code> switches the light on for <code>&lt;duration_ms&gt;</code> ms, then light goes back to passive mode. <code>blink</code> changes the light state very <code>interval_ms</code> on/off, <code>wave</code> uses pwm to for soft changes between on and off states. Optional comma-speratated phase [0.0, ..., 1.0] can be added as a phase-shift. Two lights, one with <code>wave 1000</code> and one with <code>wave 1000,0.5</code> blink inverse. Patterns can be specified as string containing <code>+</code>,<code>-</code>,<code>0</code>..<code>9</code> or <code>r</code>. <code>+</code> is light on during <code>&lt;intervall&gt;</code> ms, <code>-</code> is off, <code>0</code>..<code>9</code> brightness-level. An <code>r</code> at the end of the pattern repeats the pattern. <code>"pattern +-+-+-+++-+++-+++-+-+-+---r,100"</code> lets the board signal SOS.   </td></tr>
</table>
<h3>Example</h3>
<p >To switch the display on, the following message will be sent:</p>
<div class="fragment"><div class="line">&lt;mupplet-name&gt;/light/set    on</div>
</div><!-- fragment --><p >The mupplet switches the illumination on at 100% and reposnds with:</p>
<div class="fragment"><div class="line">&lt;mupplet-name&gt;/light/state          on</div>
<div class="line">&lt;mupplet-name&gt;/light/unitbrightness 1.000</div>
</div><!-- fragment --> <h2>General Program Item Format</h2>
<p >A program item can be represented in one string by separating it's parts with semicolons. When submitting program items, it is possible to omit values. In this case the display default value is taken. When replacing items, the default is the previous value instead allowing to change only spcific values.</p>
<div class="fragment"><div class="line">[&lt;mode&gt;];[&lt;repeat&gt;];[&lt;duration&gt;];[&lt;speed&gt;];[&lt;font&gt;][;&lt;content&gt;]</div>
</div><!-- fragment --><p >The value of <code>mode</code> is not case sensistive.</p>
<h2>Display Default Values</h2>
<p >The display allows to set the default values program items. The availability of default values simplifies specifying and submitting program items or content shortcuts.</p>
<p >The builtin default values are: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Value Name   </th><th class="markdownTableHeadNone">Value    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>mode</code>   </td><td class="markdownTableBodyNone"><code>left</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>repeat</code>   </td><td class="markdownTableBodyNone"><code>1</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>duration</code>   </td><td class="markdownTableBodyNone"><code>2000</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>speed</code>   </td><td class="markdownTableBodyNone"><code>16</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>font</code>   </td><td class="markdownTableBodyNone"><code>0</code>   </td></tr>
</table>
<h3>Setting and Getting the Default Values</h3>
<p >The communication follows the standard get/set pattern: in order to query a value, a message with the following topic must be sent:</p>
<p ><code>&lt;mupplet-name&gt;/display/default/&lt;value-name&gt;/get</code></p>
<p >The value is returned in a message with the topic:</p>
<p ><code>&lt;mupplet-name&gt;/display/default/&lt;value-name&gt;</code></p>
<p >In order to set a value, a message with the following topic and the value in the body must be sent:</p>
<p ><code>&lt;mupplet-name&gt;/display/default/&lt;value-name&gt;/set</code></p>
<p >If the value was parsed correctly and accepted, a message containing the new value is returned with the following topic:</p>
<p ><code>&lt;mupplet-name&gt;/display/default/&lt;value-name&gt;</code></p>
<p >Example: </p><div class="fragment"><div class="line">SEND&gt; &lt;mupplet-name&gt;/display/default/mode/get</div>
<div class="line">RECV&gt; &lt;mupplet-name&gt;/display/default/mode left</div>
<div class="line"> </div>
<div class="line">SEND&gt; matrix/display/default/mode/set center</div>
<div class="line">RECV&gt; &lt;mupplet-name&gt;/display/default/mode center</div>
</div><!-- fragment --><p >By omitting the value name in the topic, it is possible to get or set the entire default settings:</p>
<p >Example: </p><div class="fragment"><div class="line">SEND&gt; &lt;mupplet-name&gt;/display/default/get</div>
<div class="line">RECV&gt; &lt;mupplet-name&gt;/display/default center;1;2000;16;0</div>
<div class="line"> </div>
<div class="line">SEND&gt; &lt;mupplet-name&gt;/display/default/set right;;3000;;</div>
<div class="line">RECV&gt; &lt;mupplet-name&gt;/display/default right;1;3000;16;0</div>
</div><!-- fragment --><h2>Managing Program Items</h2>
<p >Program Items can be managed using messages. The base hierarchy of topics used to manage program items is:</p>
<p ><code>&lt;mupplet-name&gt;/display/items/</code></p>
<p >All messages in this hierarchy require the full specification of program items (See above) and also return full program items.</p>
<p >A simplified management of program items is available using the base topic hierarchy:</p>
<p ><code>&lt;mupplet-name&gt;/display/content/</code></p>
<p >In this hierarchy, only the content must be speicifed and only the content is returned. Messages that will generate new program items, will take all other parameters from the default settings. Messages that will change existing program items, will only replace the program items content.</p>
<p >All subsequent documentation use the <code>items</code> hierarchy but the same messages are also implemented in the <code>content</code> topic hierarchy.</p>
<h3>Setting and Getting Program Items</h3>
<p >Also program items are managed following the standard get/set pattern. Program items are <b>named</b>. This means, that they will be accessible by specifying their name. It is also possible to create program items without specifying a name. In this case, a unique name will be created automatically returned with the confirmation message.</p>
<p >By setting a program item, it will be created if it does not exist, or updated if it does exist. If the program item is displayed whilst it is updated, the display operation for the item will restart.</p>
<p >In order to create a new or modify an existing program item, a message with the following topic and the value in the body must be sent:</p>
<p ><code>&lt;mupplet-name&gt;/display/items/&lt;item-name&gt;/set</code></p>
<p >If the program item was parsed correctly and accepted, a message containing the resulting program item is returned with the following topic:</p>
<p ><code>&lt;mupplet-name&gt;/display/items/&lt;item-name&gt;</code></p>
<p >Example: </p><div class="fragment"><div class="line">SEND&gt; &lt;mupplet-name&gt;/display/items/clock/set center;0;6000;;2;17:52:05</div>
<div class="line">RECV&gt; &lt;mupplet-name&gt;/display/items/clock center;0;6000;16;2;17:52:05</div>
<div class="line"> </div>
<div class="line">SEND&gt; &lt;mupplet-name&gt;/display/items/date/set center;0;2000;;2;Mon, June 27 2021</div>
<div class="line">RECV&gt; &lt;mupplet-name&gt;/display/items/date/set center;0;2000;16;2;Mon, June 27 2021</div>
</div><!-- fragment --><p >The following example sets two program items that will alternate indefinitively. The time value will be shown for 6 seconds, the date value for two seconds.</p>
<p >Updating the values is quite simple: </p><div class="fragment"><div class="line">SEND&gt; &lt;mupplet-name&gt;/display/items/clock/set ;;;;;17:52:06</div>
<div class="line">RECV&gt; &lt;mupplet-name&gt;/display/items/clock center;0;6000;16;2;17:52:06</div>
</div><!-- fragment --><p >There is also a shortcut topic hierarchy that allows to operate only on contents: </p><div class="fragment"><div class="line">SEND&gt; &lt;mupplet-name&gt;/display/content/clock/set 17:52:06</div>
<div class="line">RECV&gt; &lt;mupplet-name&gt;/display/content/clock 17:52:06</div>
</div><!-- fragment --><p >It is also possible to create content using this topic hierarchy. In this case all program item values are taken from the default settings.</p>
<h3>Jumping to Program Items</h3>
<p >Program items are presented in the order they are created in the program list but it is possible to jump directly to a program item. This can be achieved by sending a message with the following topic:</p>
<p ><code>&lt;mupplet-name&gt;/display/items/&lt;item-name&gt;/jump</code></p>
<p >On success the system returns the current program item in the topic:</p>
<p ><code>&lt;mupplet-name&gt;/display/items/&lt;item-name&gt;</code></p>
<h3>Removing Program Items</h3>
<p >Program items are automatically removed when they reach the specified repetition. If a program item was specified with 0 as the repeat value, it will stay there forever until it is deleted manually. This can be achieved by sending a message with the following topic:</p>
<p ><code>&lt;mupplet-name&gt;/display/items/&lt;item-name&gt;/clear</code></p>
<p >On success the system returns the number of active items in the topic:</p>
<p ><code>&lt;mupplet-name&gt;/display/count</code></p>
<h3>Operating on all Program Items</h3>
<h4>Get iItem Count</h4>
<p >The number of active items can be queried by sending a message with the topic:</p>
<p ><code>&lt;mupplet-name&gt;/display/count/get</code></p>
<p >The current number of program items will be returned in the topic</p>
<p ><code>&lt;mupplet-name&gt;/display/count</code></p>
<h4>Delete all program items</h4>
<p >All program items can be deleted by sending a message with the topic:</p>
<p ><code>&lt;mupplet-name&gt;/display/items/clear</code></p>
<p >On success the system returns the number of active items in the topic:</p>
<p ><code>&lt;mupplet-name&gt;/display/count</code></p>
<h4>Get all Active Items</h4>
<p >A list of all active progarm items can be get by seind a message with the topic:</p>
<p ><code>&lt;mupplet-name&gt;/display/items/get</code></p>
<p >Each active program item will be returned in a message with the topic:</p>
<p ><code>&lt;mupplet-name&gt;/display/items/&lt;item-name&gt;</code></p>
<p >Example: </p><div class="fragment"><div class="line">SEND&gt; &lt;mupplet-name&gt;/display/items/get</div>
<div class="line">RECV&gt; &lt;mupplet-name&gt;/display/items/clock center;0;6000;16;2;17:52:05</div>
<div class="line">      &lt;mupplet-name&gt;/display/items/date center;0;2000;16;2;Mon, June 27 201</div>
</div><!-- fragment --><h3>Add Item without specifying a name</h3>
<p >An program item can be added without specifying a name by sending a message with the following topic:</p>
<p ><code>&lt;mupplet-name&gt;/display/items/add</code></p>
<p >If the program item was parsed correctly and accepted, a message containing the resulting program item is returned with the following topic:</p>
<p ><code>&lt;mupplet-name&gt;/display/items/&lt;item-name&gt;</code></p>
<p >Example: ```` SEND&gt; &lt;mupplet-name&gt;/display/items/add slidein;1;6000;;2;Leopoldo! RECV&gt; &lt;mupplet-name&gt;/display/items/unnamed_7712 slidein;1;6000;16;2;Leopoldo! ````` </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
